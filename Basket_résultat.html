<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stats Ball League - R√©sultats Publics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/1.0.0-beta.3/lucide.min.css">
    <script>
        // Script Lucide pour les ic√¥nes
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    </script>
    <style>
        /* Styles suppl√©mentaires pour le d√©grad√© */
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #3730a3 100%);
            min-height: 100vh;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }
        .auto-refresh-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <!-- En-t√™te -->
            <div class="text-center mb-8">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trophy w-16 h-16 text-yellow-400">
                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                        <path d="M4 22h16"></path>
                        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                    </svg>
                    <h1 class="text-5xl font-bold text-white">Stats Ball League</h1>
                </div>
                <p class="text-blue-200 text-lg">R√©sultats en direct - Consultation publique</p>
                
                <div class="mt-4 flex flex-wrap items-center justify-center gap-4">
                    <button id="refreshButton" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg flex items-center gap-2 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw w-4 h-4">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                            <path d="M21 3v5h-5"></path>
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                            <path d="M3 21v-5h5"></path>
                        </svg>
                        Actualiser
                    </button>
                    <div class="flex items-center gap-2">
                        <span class="text-blue-300 text-sm">
                            Derni√®re mise √† jour : <span id="lastUpdate">--:--:--</span>
                        </span>
                        <div id="autoRefreshIndicator" class="hidden flex items-center gap-1 text-green-300 text-sm">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            <span>Mise √† jour automatique</span>
                        </div>
                    </div>
                    <div class="text-xs text-blue-300">
                        <span id="dataStatus">Chargement des donn√©es...</span>
                    </div>
                </div>
            </div>

            <!-- Contenu principal -->
            <div id="contentArea">
                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Classement -->
                    <div class="lg:col-span-2 glass-effect rounded-2xl shadow-2xl p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up w-8 h-8 text-yellow-400">
                                <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
                                <polyline points="16 7 22 7 22 13"></polyline>
                            </svg>
                            <h2 class="text-3xl font-bold text-white">Classement</h2>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="px-4 py-3 text-left text-yellow-300 font-semibold">#</th>
                                        <th class="px-4 py-3 text-left text-yellow-300 font-semibold">√âquipe</th>
                                        <th class="px-4 py-3 text-center text-yellow-300 font-semibold">J</th>
                                        <th class="px-4 py-3 text-center text-yellow-300 font-semibold">V</th>
                                        <th class="px-4 py-3 text-center text-yellow-300 font-semibold">D</th>
                                        <th class="px-4 py-3 text-center text-yellow-300 font-semibold">PM</th>
                                        <th class="px-4 py-3 text-center text-yellow-300 font-semibold">PC</th>
                                        <th class="px-4 py-3 text-center text-yellow-300 font-semibold">Diff</th>
                                        <th class="px-4 py-3 text-center text-yellow-300 font-semibold">Pts</th>
                                    </tr>
                                </thead>
                                <tbody id="rankingTable">
                                    <!-- Les donn√©es seront inject√©es ici par JavaScript -->
                                    <tr>
                                        <td colspan="9" class="px-4 py-8 text-center text-blue-200">
                                            Chargement des donn√©es...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Derniers matchs -->
                    <div class="glass-effect rounded-2xl shadow-2xl p-6">
                        <div class="flex items-center gap-3 mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar w-8 h-8 text-yellow-400">
                                <path d="M8 2v4"></path>
                                <path d="M16 2v4"></path>
                                <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                                <path d="M3 10h18"></path>
                            </svg>
                            <h2 class="text-2xl font-bold text-white">Derniers Matchs</h2>
                        </div>
                        
                        <div class="space-y-4 max-h-[600px] overflow-y-auto" id="recentMatches">
                            <!-- Les matchs r√©cents seront inject√©s ici -->
                            <p class="text-blue-200 text-center py-8">Chargement des matchs...</p>
                        </div>
                    </div>
                </div>

                <!-- Statistiques globales -->
                <div class="mt-6 grid md:grid-cols-3 gap-4" id="globalStats">
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <p class="text-blue-200 text-sm mb-2">Total √âquipes</p>
                        <p class="text-4xl font-bold text-white">0</p>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <p class="text-blue-200 text-sm mb-2">Matchs Jou√©s</p>
                        <p class="text-4xl font-bold text-white">0</p>
                    </div>
                    <div class="glass-effect rounded-xl p-6 text-center">
                        <p class="text-blue-200 text-sm mb-2">Points Marqu√©s</p>
                        <p class="text-4xl font-bold text-white">0</p>
                    </div>
                </div>
            </div>

            <!-- Message quand aucune donn√©e -->
            <div id="noDataMessage" class="hidden">
                <div class="glass-effect rounded-2xl p-12 text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar w-24 h-24 text-blue-300 mx-auto mb-4">
                        <path d="M8 2v4"></path>
                        <path d="M16 2v4"></path>
                        <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                        <path d="M3 10h18"></path>
                    </svg>
                    <h2 class="text-2xl font-bold text-white mb-2">Aucune donn√©e disponible</h2>
                    <p class="text-blue-200">
                        Les r√©sultats appara√Ætront ici d√®s que des matchs seront enregistr√©s dans l'administration
                    </p>
                </div>
            </div>

            <!-- Footer -->
            <div class="mt-8 text-center text-blue-300 text-sm">
                <p>üèÄ Stats Ball League - Consultation publique des r√©sultats</p>
                <p class="mt-2">Les donn√©es sont mises √† jour en temps r√©el depuis l'administration</p>
            </div>
        </div>
    </div>

    <script>
        // Cl√©s pour le localStorage (LES M√äMES QUE L'ADMIN)
        const STORAGE_KEYS = {
            TEAMS: 'basketball-teams-shared',
            MATCHES: 'basketball-matches-shared',
            LAST_UPDATE: 'basketball-last-update'
        };

        // Variables
        let teams = [];
        let matches = [];
        let lastUpdateTime = null;
        let autoRefreshInterval = null;

        // Charger les donn√©es depuis le localStorage
        function loadData() {
            try {
                // Charger les √©quipes
                const savedTeams = localStorage.getItem(STORAGE_KEYS.TEAMS);
                if (savedTeams) {
                    teams = JSON.parse(savedTeams);
                }
                
                // Charger les matchs
                const savedMatches = localStorage.getItem(STORAGE_KEYS.MATCHES);
                if (savedMatches) {
                    matches = JSON.parse(savedMatches);
                }
                
                // Charger la derni√®re mise √† jour
                const savedUpdate = localStorage.getItem(STORAGE_KEYS.LAST_UPDATE);
                if (savedUpdate) {
                    lastUpdateTime = new Date(savedUpdate);
                }
                
                return true;
            } catch (error) {
                console.error('Erreur lors du chargement des donn√©es:', error);
                return false;
            }
        }

        // Calculer les statistiques
        function calculateStats() {
            const stats = {};
            
            teams.forEach(team => {
                stats[team] = {
                    played: 0, won: 0, lost: 0,
                    pointsFor: 0, pointsAgainst: 0,
                    diff: 0, points: 0
                };
            });

            matches.forEach(match => {
                const { team1, team2, score1, score2 } = match;
                
                if (stats[team1]) {
                    stats[team1].played++;
                    stats[team1].pointsFor += score1;
                    stats[team1].pointsAgainst += score2;
                    stats[team1].diff = stats[team1].pointsFor - stats[team1].pointsAgainst;
                    if (score1 > score2) {
                        stats[team1].won++;
                        stats[team1].points += 2;
                    } else {
                        stats[team1].lost++;
                        stats[team1].points += 1;
                    }
                }
                
                if (stats[team2]) {
                    stats[team2].played++;
                    stats[team2].pointsFor += score2;
                    stats[team2].pointsAgainst += score1;
                    stats[team2].diff = stats[team2].pointsFor - stats[team2].pointsAgainst;
                    if (score2 > score1) {
                        stats[team2].won++;
                        stats[team2].points += 2;
                    } else {
                        stats[team2].lost++;
                        stats[team2].points += 1;
                    }
                }
            });

            return Object.entries(stats)
                .sort((a, b) => b[1].points - a[1].points || b[1].diff - a[1].diff)
                .map(([team, stat]) => ({ team, ...stat }));
        }

        // Mettre √† jour l'affichage
        function updateDisplay() {
            const hasData = teams.length > 0;
            
            // Afficher/masquer le contenu appropri√©
            document.getElementById('contentArea').classList.toggle('hidden', !hasData);
            document.getElementById('noDataMessage').classList.toggle('hidden', hasData);
            
            if (!hasData) {
                document.getElementById('dataStatus').textContent = 'En attente de donn√©es...';
                return;
            }
            
            const rankings = calculateStats();
            const recentMatches = [...matches].reverse().slice(0, 10);
            
            // Mettre √† jour le classement
            const rankingTable = document.getElementById('rankingTable');
            rankingTable.innerHTML = '';
            
            rankings.forEach((stat, idx) => {
                const row = document.createElement('tr');
                row.className = `border-b border-white/10 ${idx === 0 ? 'bg-yellow-500/20' : 'hover:bg-white/5'} transition`;
                
                row.innerHTML = `
                    <td class="px-4 py-4 text-white font-bold text-lg">
                        ${idx === 0 ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trophy w-5 h-5 text-yellow-400 inline mr-2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>' : ''}
                        ${idx + 1}
                    </td>
                    <td class="px-4 py-4 text-white font-semibold text-lg">${stat.team}</td>
                    <td class="px-4 py-4 text-center text-blue-200">${stat.played}</td>
                    <td class="px-4 py-4 text-center text-green-400 font-semibold">${stat.won}</td>
                    <td class="px-4 py-4 text-center text-red-400 font-semibold">${stat.lost}</td>
                    <td class="px-4 py-4 text-center text-blue-200">${stat.pointsFor}</td>
                    <td class="px-4 py-4 text-center text-blue-200">${stat.pointsAgainst}</td>
                    <td class="px-4 py-4 text-center font-semibold ${stat.diff > 0 ? 'text-green-400' : stat.diff < 0 ? 'text-red-400' : 'text-gray-400'}">
                        ${stat.diff > 0 ? '+' : ''}${stat.diff}
                    </td>
                    <td class="px-4 py-4 text-center font-bold text-xl text-yellow-400">${stat.points}</td>
                `;
                rankingTable.appendChild(row);
            });
            
            // Mettre √† jour les matchs r√©cents
            const recentMatchesDiv = document.getElementById('recentMatches');
            recentMatchesDiv.innerHTML = '';
            
            if (recentMatches.length === 0) {
                recentMatchesDiv.innerHTML = '<p class="text-blue-200 text-center py-8">Aucun match jou√©</p>';
            } else {
                recentMatches.forEach(match => {
                    const matchDiv = document.createElement('div');
                    matchDiv.className = 'bg-white/5 hover:bg-white/10 p-4 rounded-xl transition border border-white/10';
                    matchDiv.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold ${match.score1 > match.score2 ? 'text-green-400' : 'text-white'}">
                                ${match.team1}
                            </span>
                            <span class="text-2xl font-bold text-yellow-400">${match.score1}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold ${match.score2 > match.score1 ? 'text-green-400' : 'text-white'}">
                                ${match.team2}
                            </span>
                            <span class="text-2xl font-bold text-yellow-400">${match.score2}</span>
                        </div>
                        <p class="text-blue-300 text-sm text-right">${match.date}</p>
                    `;
                    recentMatchesDiv.appendChild(matchDiv);
                });
            }
            
            // Mettre √† jour les statistiques globales
            const totalPoints = matches.reduce((sum, m) => sum + m.score1 + m.score2, 0);
            document.getElementById('globalStats').innerHTML = `
                <div class="glass-effect rounded-xl p-6 text-center">
                    <p class="text-blue-200 text-sm mb-2">Total √âquipes</p>
                    <p class="text-4xl font-bold text-white">${teams.length}</p>
                </div>
                <div class="glass-effect rounded-xl p-6 text-center">
                    <p class="text-blue-200 text-sm mb-2">Matchs Jou√©s</p>
                    <p class="text-4xl font-bold text-white">${matches.length}</p>
                </div>
                <div class="glass-effect rounded-xl p-6 text-center">
                    <p class="text-blue-200 text-sm mb-2">Points Marqu√©s</p>
                    <p class="text-4xl font-bold text-white">${totalPoints}</p>
                </div>
            `;
            
            // Mettre √† jour l'heure
            const updateTime = lastUpdateTime || new Date();
            document.getElementById('lastUpdate').textContent = updateTime.toLocaleTimeString('fr-FR');
            
            // Mettre √† jour le statut
            document.getElementById('dataStatus').textContent = `Donn√©es charg√©es (${teams.length} √©quipes, ${matches.length} matchs)`;
        }

        // V√©rifier les mises √† jour automatiquement
        function checkForUpdates() {
            const lastSavedUpdate = localStorage.getItem(STORAGE_KEYS.LAST_UPDATE);
            
            if (lastSavedUpdate && (!lastUpdateTime || new Date(lastSavedUpdate) > lastUpdateTime)) {
                console.log('Nouvelles donn√©es d√©tect√©es, mise √† jour...');
                loadData();
                updateDisplay();
                
                // Animation de mise √† jour
                const indicator = document.getElementById('autoRefreshIndicator');
                indicator.classList.remove('hidden');
                setTimeout(() => {
                    indicator.classList.add('hidden');
                }, 3000);
            }
        }

        // Initialiser l'affichage
        function init() {
            // Charger les donn√©es initiales
            loadData();
            updateDisplay();
            
            // Configurer la v√©rification automatique toutes les 3 secondes
            autoRefreshInterval = setInterval(checkForUpdates, 3000);
            
            // √âcouter les changements de localStorage
            window.addEventListener('storage', function(event) {
                if (event.key === STORAGE_KEYS.TEAMS || event.key === STORAGE_KEYS.MATCHES) {
                    console.log('Changement d√©tect√© dans localStorage, mise √† jour...');
                    loadData();
                    updateDisplay();
                    
                    // Afficher l'indicateur de mise √† jour
                    const indicator = document.getElementById('autoRefreshIndicator');
                    indicator.classList.remove('hidden');
                    setTimeout(() => {
                        indicator.classList.add('hidden');
                    }, 3000);
                }
            });
            
            // G√©rer le bouton Actualiser
            document.getElementById('refreshButton').addEventListener('click', function() {
                loadData();
                updateDisplay();
                this.classList.add('auto-refresh-animation');
                setTimeout(() => {
                    this.classList.remove('auto-refresh-animation');
                }, 1000);
            });
        }

        // D√©marrer l'application
        document.addEventListener('DOMContentLoaded', init);
        
        // Nettoyer l'intervalle √† la fermeture
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>